var t_col_status=new t($("#t-col-status").html()),t_col_tasks=new t($("#t-col-tasks").html()),t_task=new t($("#t-card").html()),t_card_project=new t($("#t-card-project").html()),t_card_user_assigned_to=new t($("#t-card-user-assigned-to").html()),t_card_work_hours=new t($("#t-card-work-hours").html()),t_card_estimate=new t($("#t-card-estimate").html()),t_allowed_users=new t($("#t-dropdown-allowed-users").html()),t_estimates=new t($("#t-dropdown-estimates").html()),sidebar_w;String.prototype.sprintf=function(){var t=this;for(var s in arguments)t=t.replace("{"+s+"}",arguments[s]);return t};var get_screen_size=function(){return $("#screen-size :visible").attr("data-size")},obj_to_arr=function(t){return $.map(t,function(t){return[t]})},format_hours=function(t){var s;if(8>t)s=t+"h";else{s=Math.floor(t/8)+"d";var e=Math.floor(t%8);e>0&&(s+=" "+e+"h")}return s},show_growl_msg=function(t){try{$.bootstrapGrowl(t.data.message,{type:"info"})}catch(s){}},add_task_to_status_col=function(t,s){try{t.status_color=status_colors[t.terms.kanban_task_status[0]]}catch(e){}"undefined"==typeof t.terms.kanban_task_estimate&&(t.terms.kanban_task_estimate=0),"undefined"==typeof t.postmeta.kanban_task_user_id_assigned&&(t.postmeta.kanban_task_user_id_assigned="");var a=$(t_task.render(t));return a.prependTo("#status-{0}-tasks".sprintf(s)).board_task(t),$(".col-tasks").same_height(),a};jQuery(function(t){t("#filter-wrapper").board_filter(),t("#search-wrapper").board_search(),t("#btn-group-view-compact").board_view();var s=obj_to_arr(project_records);projects=new Bind({projects:s},{projects:{dom:"#filter-projects-dropdown",transform:function(t){return'<li><a href="#" data-id="'+t.ID+'">'+this.safe(t.post_title)+"</a></li>"}}});var e=obj_to_arr(allowed_users);users=new Bind({users:e},{users:{dom:"#filter-users-dropdown",transform:function(t){return'<li><a href="#" data-id="'+t.data.ID+'">'+this.safe(t.data.long_name_email)+"</a></li>"}}});for(var a in status_records){var r=status_records[a];try{r.color=status_colors[r.term_id]}catch(o){}0==a&&(r.left_open=0,r.left_close="-{0}".sprintf(sidebar_w)),a==status_records.length-1&&(r.left_open="-{0}".sprintf(2*sidebar_w),r.left_close="-{0}".sprintf(sidebar_w));var n=t(t_col_status.render(r));n.appendTo("#row-statuses").board_sidebar_header();var n=t(t_col_tasks.render(r));n.appendTo("#row-tasks"),statuses[r.term_id]=r}for(var a in task_records){var i=task_records[a];if("undefined"==typeof i.terms.kanban_task_status[0]||0==i.terms.kanban_task_status[0]||"undefined"==typeof statuses[i.terms.kanban_task_status[0]]){var d=t("#row-statuses .col").eq(1).attr("data-id");i.terms.kanban_task_status[0]=d}add_task_to_status_col(i,i.terms.kanban_task_status[0])}t(".col-tasks").sortable({connectWith:".col-tasks",handle:".task-handle",forcePlaceholderSize:!0,forceHelperSize:!0,placeholder:"task-placeholder",over:function(t,s){s.placeholder.closest(".col-tasks").addClass("hover")},out:function(t,s){s.placeholder.closest(".col-tasks").removeClass("hover")},stop:function(){t(".col-tasks.hover").removeClass("hover")},receive:function(s,e){var a=e.item.attr("data-id"),r=e.item.closest(".col-tasks"),o=r.attr("data-status-id"),n=r.attr("data-color");tasks[a].task.status_color=n,tasks[a].task.terms.kanban_task_status=[o],e.item.trigger("add_comment",['{0} moved the task to "{1}"'.sprintf(current_user.short_name,t(".status_name",r).text())]),t(".col-tasks").same_height()}}).disableSelection(),t("body").on("keydown",function(s){var e=t("input:focus, textarea:focus");return 37===s.keyCode&&0===e.length&&s.shiftKey&&(t(".col-status:last").hasClass("is-open")?t(".col-status:last").trigger("close"):t(".col-status:first").hasClass("is-open")||t(".col-status:first").trigger("open")),39===s.keyCode&&0===e.length&&s.shiftKey&&(t(".col-status:first").hasClass("is-open")?t(".col-status:first").trigger("close"):t(".col-status:last").hasClass("is-open")||t(".col-status:last").trigger("open")),9===s.keyCode&&0===e.length?(t("#btn-group-view-compact .btn:has(input:not(:checked))").trigger("click"),!1):83===s.keyCode&&0===e.length?(t("#board-search").focus(),!1):void 0});var l=[];if(window.location.hash){var c=window.location.hash.substr(1).split("&");for(var a in c){var _=c[a].split("=");"undefined"!=typeof _[1]&&(l[_[0]]=_[1])}}var u=!1;"undefined"!=typeof l.filter_project&&(t("#filter-projects-dropdown [data-id="+l.filter_project+"]").click(),u=!0),"undefined"!=typeof l.filter_user&&(t("#filter-users-dropdown [data-id="+l.filter_user+"]").click(),u=!0),u&&t("#btn-filter-apply").trigger("click"),t(".col-tasks").on("mouseenter",function(){var s=t(this).attr("data-status-id");t("#status-{0}".sprintf(s)).addClass("hover")}).on("mouseleave",function(){var s=t(this).attr("data-status-id");t("#status-{0}".sprintf(s)).removeClass("hover")}),t(window).load(function(){t(".col-tasks").same_height()}),t(window).resize(function(){t(".col-tasks").same_height()})});